<!doctype html>
<html lang="et">

<head>
    <!-- ───────────────────────────────────────────────────────────
       Document Metadata
  ─────────────────────────────────────────────────────────── -->
    <meta charset="utf-8" />
    <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">

    <title>Õnneratas</title>
    <meta name="description"
        content="Õnneratas Premium Edition — iga päev üks tasuta keerutus ja pidulik võitude ajalugu." />
    <meta name="theme-color" content="#0b0f1a" id="themeColor" />

    <!-- iOS PWA -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes"> <!-- fallback 
    vanematele iOS versioonidele -->


    <!-- Favicon (väldib 404) -->
    <link rel="icon" href="/favicon.ico">

    <!-- ───────────────────────────────────────────────────────────
       CSS (order matters): polyfill → icons → app styles
  ─────────────────────────────────────────────────────────── -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/dialog-polyfill@0.5.6/dist/dialog-polyfill.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="styles.css" />

    <link rel="stylesheet" href="/css/variables.css">
    <link rel="stylesheet" href="/css/base.css">
    <link rel="stylesheet" href="/css/layout.css">

    <!-- Komponendid -->
    <link rel="stylesheet" href="/css/components.buttons.css">
    <link rel="stylesheet" href="/css/components.cards.css">
    <link rel="stylesheet" href="/css/components.modals.css">
    <link rel="stylesheet" href="/css/components.forms.css">
    <link rel="stylesheet" href="/css/components.panels-history.css">
    <link rel="stylesheet" href="/css/components.meter.css">
    <link rel="stylesheet" href="/css/components.free-spins.css">
    <link rel="stylesheet" href="/css/components.wheel.css">

    <!-- Spetsiifilised vaated/listid -->
    <link rel="stylesheet" href="/css/login.modal.css">

    <link rel="stylesheet" href="/css/wallet.list.css">
    <link rel="stylesheet" href="/css/misc.css">

</head>

<body>
    <noscript>
        <!-- Accessibility: helpful message if JS is disabled -->
        <div style="padding:12px; background:#300; color:#fff; text-align:center;">
            JavaScript on required for this app to run. Please enable JavaScript.
        </div>
    </noscript>

    <div class="app">
        <!-- ─────────────────────────────────────────────────────────
         Top Bar
    ───────────────────────────────────────────────────────── -->
        <header class="topbar">
            <div class="brand" data-auth-only aria-label="Õnneratas bränd">
                <img src="images/logo.png" alt="Õnneratas logo" class="brand-logo">
            </div>


            <!-- Nähtav ainult siis, kui user on sees -->
            <div id="userArea" class="ghost" style="display:none; align-items:center; gap:.5rem" data-auth-only>

                <button id="logoutBtn" class="ghost" type="button" title="Logi välja">Logi välja</button>
            </div>

            <div class="top-actions">

            </div>
        </header>

        <!-- ─────────────────────────────────────────────────────────
         Main Stage
    ───────────────────────────────────────────────────────── -->
        <main class="stage">
            <!-- Wheel -->
            <!-- Wheel -->
            <div class="wheel-wrap" aria-live="polite">
                <div id="rotor" class="rotor">
                    <canvas id="wheel" aria-label="Õnneratas"></canvas>
                    <ul class="bulbs" id="bulbs" aria-hidden="true"></ul>
                </div>

                <div class="axle">
                    <button id="spinBtn" class="spin-btn" type="button" aria-label="Alusta keerutust">
                        <span id="freeSpinTag" class="spin-sub" hidden>START</span>
                    </button>
                </div>

                <div class="pointer" aria-hidden="true"></div>
            </div>

            <!-- See ilmub ainult välja logituna -->
            <!-- See ilmub ainult välja logituna -->
            <div id="loggedOutImage" class="logged-out-only" style="display:none; text-align:center; margin-top:1rem;">
                <img src="images/pic.png" alt="Logi sisse, et mängida" style="max-width:200px; cursor:pointer;"
                    data-open-dialog="loginModal">
            </div>



            <!-- Login vihje mull (näidatakse vaid vajadusel) -->
            <div id="loginHint" class="chat-bubble hidden" role="status" aria-live="polite">
                <i class="fa-solid fa-message"></i>
                <span>Jätkamiseks logi sisse, kallis!</span>
            </div>


            <!-- Secondary Actions (peidetakse väljalogituna) -->
            <div class="actions" data-auth-only>
                <button id="myPrizesBtn" class="ghost wallet-cta" type="button" title="View your prize history"
                    data-open-dialog="walletModal">
                    <span>MINU VÕIDUD</span>
                    <span id="walletBadge" class="wallet-badge" aria-hidden="true" style="display:none">0</span>
                </button>
            </div>

            <!-- Free Spins Panel (peidetakse väljalogituna) -->
            <section class="meter panel" id="freeMeter" data-auth-only aria-live="polite">
                <h2 class="meter-title sr-only">Tasuta keerutused</h2>
                <div id="freeList" class="free-list"></div>
                <div id="nextFreeInfo" class="meter-row small muted"></div>
            </section>

            <!-- Confetti Canvas -->
            <canvas id="confetti" class="confetti" aria-hidden="true"></canvas>
        </main>
    </div><!-- /.app -->

    <!-- ─────────────────────────────────────────────────────────
       MODALS OUTSIDE .app  → ei sõltu .app paigutusest/laiusest
  ───────────────────────────────────────────────────────── -->

    <!-- Auth modal (login + sign up) -->
    <dialog id="loginModal" class="modal">
        <div class="modal-card">
            <header>
                <h3>Logi sisse</h3>
            </header>

            <div class="modal-body">
                <!-- LOGIN -->
                <form id="loginForm" class="login-form auth-pane" data-pane="login" novalidate>
                    <div class="free-card login-fields">
                        <!-- E-post -->
                        <div class="field">
                            <label for="loginEmail" class="sr-only">E-post</label>
                            <div class="input-wrap">
                                <i class="fa-solid fa-envelope icon-left" aria-hidden="true"></i>
                                <input id="loginEmail" type="email" placeholder="E-post" autocomplete="email" required>
                                <div id="loginEmailErr" class="error-msg" aria-live="polite"></div>
                            </div>
                        </div>
                        <!-- Parool -->
                        <div class="field">
                            <label for="loginPass" class="sr-only">Parool</label>
                            <div class="input-wrap">
                                <i class="fa-solid fa-lock icon-left" aria-hidden="true"></i>
                                <input id="loginPass" type="password" placeholder="Parool"
                                    autocomplete="current-password" required>
                                <div id="loginPassErr" class="error-msg" aria-live="polite"></div>
                            </div>
                        </div>
                        <div class="aux-row">
                            <a href="#" id="forgotLink" class="muted small">Unustasid parooli?</a>
                        </div>
                    </div>

                    <footer class="login-actions">
                        <button type="submit" id="loginSubmitBtn" class="primary">Logi sisse</button>
                    </footer>

                    <!-- LINK: Loo konto -->
                    <p class="auth-switch small muted">
                        <a href="#" id="toSignupLink">Loo konto</a>
                    </p>
                </form>

                <!-- SIGN UP -->
                <form id="signupForm" class="login-form auth-pane hidden" data-pane="signup" novalidate>
                    <div class="free-card login-fields">
                        <!-- Nimi (valikuline) -->
                        <div class="field">
                            <label for="suName" class="sr-only">Nimi</label>
                            <div class="input-wrap">
                                <i class="fa-solid fa-user icon-left" aria-hidden="true"></i>
                                <input id="suName" type="text" placeholder="Nimi" autocomplete="name">
                            </div>
                        </div>
                        <!-- E-post -->
                        <div class="field">
                            <label for="suEmail" class="sr-only">E-post</label>
                            <div class="input-wrap">
                                <i class="fa-solid fa-envelope icon-left" aria-hidden="true"></i>
                                <input id="suEmail" type="email" placeholder="E-post" autocomplete="email" required>
                                <div id="suEmailErr" class="error-msg" aria-live="polite"></div>
                            </div>
                        </div>
                        <!-- Parool -->
                        <div class="field">
                            <label for="suPass" class="sr-only">Parool</label>
                            <div class="input-wrap">
                                <i class="fa-solid fa-lock icon-left" aria-hidden="true"></i>
                                <input id="suPass" type="password" placeholder="Parool (min 6 märki)"
                                    autocomplete="new-password" required>
                                <div id="suPassErr" class="error-msg" aria-live="polite"></div>
                            </div>
                        </div>
                        <!-- Kinnitus -->
                        <div class="field">
                            <label for="suPass2" class="sr-only">Kinnita parool</label>
                            <div class="input-wrap">
                                <i class="fa-solid fa-key icon-left" aria-hidden="true"></i>
                                <input id="suPass2" type="password" placeholder="Kinnita parool"
                                    autocomplete="new-password" required>
                                <div id="suPass2Err" class="error-msg" aria-live="polite"></div>
                            </div>
                        </div>
                    </div>

                    <footer class="login-actions">
                        <button type="submit" id="signupSubmitBtn" class="primary">Loo konto</button>
                    </footer>

                    <!-- LINK: tagasi logimisele -->
                    <p class="auth-switch small muted">
                        <a href="#" id="toLoginLink">Logi sisse</a>
                    </p>
                </form>
            </div>
        </div>
    </dialog>

    <!-- Võitude rahakoti modal (peidetakse väljalogituna) -->
    <dialog id="walletModal" class="modal" data-auth-only>
        <div class="modal-card">
            <header></header>
            <div class="modal-body">
                <div id="walletEmpty" class="muted">Pole veel võite.</div>
                <div id="walletList" class="free-list"></div>
            </div>
            <footer>
                <button class="ghost" onclick="document.getElementById('walletModal').close()">Sulge</button>
            </footer>
        </div>
    </dialog>

    <!-- ───────────────────────────────────────────────────────────
       Scripts (deferred, load order top→bottom)
  ─────────────────────────────────────────────────────────── -->
    <script src="https://cdn.jsdelivr.net/npm/dialog-polyfill@0.5.6/dist/dialog-polyfill.min.js" defer></script>

    <!-- Core utilities & app structure -->
    <script type="module" src="scripts/login.js"></script>

    <script src="scripts/viewport.js" defer></script>
    <script src="scripts/dom.js" defer></script>
    <script src="scripts/constants.js" defer></script>
    <script src="scripts/storage.js" defer></script>
    <script src="scripts/time.js" defer></script>

    <!-- UI modules -->
    <script src="scripts/dialogs.js" defer></script>

    <script src="scripts/meter.js" defer></script>
    <script src="scripts/bulbs.js" defer></script>
    <script src="scripts/wheel.js" defer></script>
    <script src="scripts/spin.js" defer></script>
    <script src="scripts/tick.js" defer></script>
    <script src="scripts/prize.js" defer></script>
    <script src="scripts/confetti.js" defer></script>
    <script src="scripts/wallet.js" defer></script>
    <script type="module" src="scripts/events.js"></script>
    <script src="scripts/setup.js" defer></script>
</body>

</html>